<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>IMACX Account System</title>
  <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: radial-gradient(ellipse at center, #050505 0%, #0d0d0d 100%);
      color: #ffffff;
    }
    .title-glow {
      font-family: 'Unbounded', cursive;
      background: linear-gradient(to right, #fff, #ffd700, #f5c518);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 25px rgba(255, 215, 0, 0.4);
    }
    .glass-box {
      backdrop-filter: blur(15px);
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 2rem;
      box-shadow: 0 10px 40px rgba(255, 255, 255, 0.05);
      padding: 2rem;
      margin-bottom: 2rem;
    }
    input, select, button {
      margin-top: 0.5rem;
      margin-bottom: 1rem;
      color: black;
    }
    input::placeholder {
      color: #888;
    }
  
  input, select {
  color: black;
  font-color: black;
}

    input, select {
  color: #000 !important;
  background-color: #fff;
    }
  </style>
</head>
<body>
  <section class="p-6 max-w-4xl mx-auto">
    <h1 class="text-5xl text-center title-glow mb-10">IMACX Account Portal</h1>

    <!-- Login -->
    <div class="glass-box">
      <h2 class="text-2xl mb-4">Login</h2>
      <input id="login-user" type="text" placeholder="Username" class="w-full text-black p-2 rounded">
      <input id="login-pass" type="password" placeholder="Password" class="w-full text-black p-2 rounded">
      <button onclick="login()" class="bg-yellow-400 px-4 py-2 rounded text-black font-semibold">Login</button>
      <p id="login-msg" class="text-red-500"></p>
    </div>

    <!-- Signup -->
    <div class="glass-box">
      <h2 class="text-2xl mb-4">Sign Up</h2>
      <input id="signup-user" type="text" placeholder="Username" class="w-full p-2 rounded" text-black bg-white

>
      <input id="signup-email" type="email" placeholder="Email" class="w-full p-2 rounded" text-black bg-white

>
      <div class="flex gap-2 mb-4">
        <select id="signup-country-code" class="p-2 rounded bg-gray-800 text-black border border-gray-600">
          <option value="+91">+91 India</option>
          <option value="+1">+1 USA</option>
          <option value="+44">+44 UK</option>
        </select>
        <input id="signup-phone" type="tel" placeholder="Phone number" class="w-full p-2 rounded" text-black bg-white

>
      </div>
      <input id="signup-pass" type="password" placeholder="Password" class="w-full p-2 rounded" text-black bg-white

>
      <input id="signup-confirm" type="password" placeholder="Confirm Password" class="w-full p-2 rounded" text-black bg-white

>
      <button onclick="signup()" class="bg-yellow-400 px-4 py-2 rounded text-black font-semibold">Sign Up</button>
      <p id="signup-msg" class="text-red-500"></p>
    </div>

    <!-- Recover Password -->
    <div id="recover-password-box" class="glass-box">
      <h2 class="text-2xl mb-4">Recover Password</h2>
      <input id="recover-user" type="text" placeholder="Username " class="w-full p-2 rounded" text-black bg-white

>
      <input id="recover-email" type="email" placeholder="Email " class="w-full p-2 rounded" text-black bg-white

>
      <div class="flex gap-2 mb-4">
        <select id="recover-country-code" class="p-2 rounded bg-gray-800 text-black border border-gray-600">
          <option value="+91">+91 India</option>
          <option value="+1">+1 USA</option>
          <option value="+44">+44 UK</option>
        </select>
        <input id="recover-phone" type="tel" placeholder="Phone number" class="w-full p-2 rounded" text-black bg-white

>
      </div>
      <button onclick="recoverPassword()" class="bg-yellow-400 px-4 py-2 rounded text-black font-semibold">Recover Password</button>
      <p id="recover-msg" class="text-red-500"></p>
    </div>

    <!-- Recover Username -->
    <div id="recover-username-box" class="glass-box">
      <h2 class="text-2xl mb-4">Recover Username</h2>
      <input id="username-recovery-email" type="email" placeholder="Email" class="w-full p-2 rounded" text-black bg-white

>
      <div class="flex gap-2 mb-4">
        <select id="username-country-code" class="p-2 rounded bg-gray-800 text-black border border-gray-600">
          <option value="+91">+91 India</option>
          <option value="+1">+1 USA</option>
          <option value="+44">+44 UK</option>
        </select>
        <input id="username-phone" type="tel" placeholder="Phone number" class="w-full p-2 rounded" text-black bg-white

>
      </div>
      <input id="username-recovery-pass" type="password" placeholder="Password" class="w-full p-2 rounded" text-black bg-white

>
      <button onclick="recoverUsername()" class="bg-yellow-400 px-4 py-2 rounded text-black font-semibold">Recover Username</button>
      <p id="username-msg" class="text-red-500"></p>
    </div>

    <!-- Account Status -->
    <div class="glass-box">
      <h2 class="text-2xl mb-4">Account Status</h2>
      <p id="status-info" class="text-gray-400"></p>
    </div>
  </section>

  <script>
    const gun = Gun();

    function timestampIST() {
      const date = new Date().toLocaleString('en-US', { timeZone: 'Asia/Kolkata' });
      return new Date(date).toISOString();
    }

  function signup() {
  const username = document.getElementById('signup-user').value.trim();
  const email = document.getElementById('signup-email').value.trim().toLowerCase();
  const phone = document.getElementById('signup-phone').value.trim();
  const countryCode = document.getElementById('signup-country-code').value.trim();
  const password = document.getElementById('signup-pass').value;
  const confirm = document.getElementById('signup-confirm').value;
  const msg = document.getElementById('signup-msg');

  if (!username || !email || !phone || !password || !confirm || !countryCode) {
    msg.innerText = 'All fields are required.';
    return;
  }

  if (password !== confirm) {
    msg.innerText = 'Passwords do not match.';
    return;
  }

  const userKey = username;

  // Check if username exists
  gun.get('imacx-accounts').get(userKey).once(existingUser => {
    if (existingUser) {
      msg.innerText = 'Username already exists.';
      return;
    } else {
      // Now check email and phone uniqueness across all users
      let emailExists = false;
      let phoneExists = false;
      const fullPhone = countryCode + phone;

      // This is asynchronous, so use a promise for cleaner handling
      new Promise((resolve) => {
        gun.get('imacx-accounts').map().once(user => {
          if (!user) return;

          // Check email
          if (user.email === email) {
            emailExists = true;
          }

          // Check phone with country code
          if (user.phone === fullPhone) {
            phoneExists = true;
          }

          // After checking all users, resolve
          resolve();
        });
      }).then(() => {
        if (emailExists) {
          msg.innerText = 'Email already exists.';
          return;
        }
        if (phoneExists) {
          msg.innerText = 'Phone number with this country code already exists.';
          return;
        }

        // If all unique, create user
        const user = {
          username,
          email,
          phone: fullPhone,
          password,
          created: timestampIST()
        };
        gun.get('imacx-accounts').get(userKey).put(user);
        msg.innerText = 'Account created successfully!';
      });
    }
  });
}  

      
 function login() {
      const username = document.getElementById('login-user').value.trim();
      const password = document.getElementById('login-pass').value;
      const msg = document.getElementById('login-msg');

      if (!username || !password) {
        msg.innerText = 'Enter both username and password.';
        return;
      }

      gun.get('imacx-accounts').get(username).once(data => {
        if (data && data.password === password) {
          msg.innerText = 'Login successful!';
          document.getElementById('status-info').innerText = `Logged in as ${username}, created at ${data.created}`;
        } else {
          msg.innerText = 'Invalid login credentials.';
        }
      });
    }

    function recoverPassword() {
      const username = document.getElementById('recover-user').value.trim();
      const email = document.getElementById('recover-email').value.trim().toLowerCase();
      const phone = document.getElementById('recover-country-code').value + document.getElementById('recover-phone').value.trim();
      const msg = document.getElementById('recover-msg');

      if (!username || !email || !phone) {
        msg.innerText = 'Please fill all fields.';
        return;
      }

      gun.get('imacx-accounts').get(username).once(data => {
        if (!data) {
          msg.innerText = 'No account found with that username.';
          return;
        }

        if (data.email === email && data.phone === phone) {
          msg.innerText = `Your password is: ${data.password}`;
        } else {
          msg.innerText = 'Credentials do not match. Cannot recover password.';
        }
      });
    }

    function recoverUsername() {
  const email = document.getElementById('username-recovery-email').value.trim().toLowerCase();
  const phone = document.getElementById('username-country-code').value + document.getElementById('username-phone').value.trim();
  const password = document.getElementById('username-recovery-pass').value;
  const msg = document.getElementById('username-msg');

  gun.get('imacx-accounts').map().once((user, key) => {
    if (user && user.email === email && user.phone === phone && user.password === password) {
      msg.innerText = `Your username is: ${key}`;
    }
  });
}
  </script>
</body>
</html>
